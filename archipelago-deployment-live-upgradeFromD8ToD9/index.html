<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="The Digital Services Team at Metropolitan New York Library Council" /><link rel="canonical" href="http://docs.archipelago.nyc/archipelago-deployment-live-upgradeFromD8ToD9/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Upgrading Drupal 8 to Drupal 9 (1.0.0-RC2 to 1.0.0-RC3) - Pala Archipelago Documentation</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../css/version-select.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Upgrading Drupal 8 to Drupal 9 (1.0.0-RC2 to 1.0.0-RC3)";
        var mkdocs_page_input_path = "archipelago-deployment-live-upgradeFromD8ToD9.md";
        var mkdocs_page_url = "/archipelago-deployment-live-upgradeFromD8ToD9/";
      </script>
    
    <script src="../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="..">
          <img src="../images/dhammacakka.png" class="logo" alt="Logo"/>
        </a>
        <div class="version">
          {'provider': 'mike', 'default': 'default'}
        </div><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">About Archipelago</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../ourtake/">Archipelago's Philosophy & Guiding Principles</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../strawberryfields/">Strawberryfields Forever</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../devops/">Software Services</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../CODE_OF_CONDUCT/">Code of Conduct</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Instructions and Guides</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="#">Archipelago-Deployment</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../archipelago-deployment-readme/">Start</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../archipelago-deployment-osx/">Installing Archipelago Drupal 9 on OSX (macOS)</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../archipelago-deployment-ubuntu/">Installing Archipelago Drupal 9 on Ubuntu 18.04 or 20.04</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../archipelago-deployment-democontent/">Adding Demo Archipelago Digital Objects (ADOs) to your Repository</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../archipelago-deployment-upgradeFromD8ToD9/">Upgrading Drupal 8 to Drupal 9 (1.0.0-RC2 to 1.0.0-RC3)</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Archipelago-Deployment-Live</a>
    <ul class="current">
                <li class="toctree-l2"><a class="reference internal" href="../archipelago-deployment-live-readme/">Start</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../archipelago-deployment-live-gitworkflow/">Github Workflow</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../archipelago-deployment-live-moveToLive/">Moving from archipelago-deployment to archipelago-deployment-live</a>
                </li>
                <li class="toctree-l2 current"><a class="reference internal current" href="./">Upgrading Drupal 8 to Drupal 9 (1.0.0-RC2 to 1.0.0-RC3)</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#what-is-this-documentation-for">What is this documentation for?</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#requirements">Requirements</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#backing-up-and-preparing-for-the-upgrade">Backing up and preparing for the upgrade</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#step-1">Step 1:</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#step-2">Step 2:</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#step-3">Step 3:</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#step-4">Step 4:</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#step-5">Step 5:</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#upgrading-to-100-rc3">Upgrading to 1.0.0-RC3</a>
        <ul>
    <li class="toctree-l4"><a class="reference internal" href="#step-1_1">Step 1:</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#step-2_1">Step 2:</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#step-3_1">Step 3:</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#step-4_1">Step 4:</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#step-5_1">Step 5:</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#step-6">Step 6:</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#step-7-update-or-not-your-metadata-display-entities-and-menu-items">Step 7: Update (or not) your Metadata Display Entities and Menu items.</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Archipelago 101</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="#">Digital Objects and Collections, Metadata, General Workflows</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../firstobject/">Ingesting Your First Object</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="#">Webforms in Archipelago</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../webforms/">Webforms</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../webformsasinput/">How to Create a Webform as an Input Method for Archipelago Digital Objects (ADO)</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../modifyingfileextensionsinwebform/">Customizing Webforms (Modifying allowable file extensions)</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../customwebformelements/">Archipelago Custom Webform Elements</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="#">Twig Templates and Archipelago</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../metadatatwigs/">Twig Templates and Archipelago</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="../workingtwigs/">Working With Twig in Archipelago (getting started with custom Twig templates)</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="#">Archipelago Multi-Importer (AMI)</a>
    <ul>
                <li class="toctree-l4"><a class="reference internal" href="../ami_index/">Archipelago Multi-Importer (AMI)</a>
                </li>
                <li class="toctree-l4"><a class="reference internal" href="#">AMI Instructions and Guides</a>
                </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../annotations/">Annotations</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Site Administration & Configuration</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../strawberryfield-formatters/">Strawberryfield Formatters</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../createdisplaymodes/">Creating Display Modes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../archifilepersistencestrategy/">Archipelago's File Persistence Strategy</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../sslsetup/">How to Set Up SSL for Docker/Archipelago</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../xdebug/">Debugging PHP in Archipelago</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="#">General Q&A</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../generalqa_index/">General Q&A</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../generalqa_twig_modules_configuration/">Twig Modules Configuration</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../generalqa_smtp_configuration/">SMTP Configuration</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../generalqa_minio_logging/">Min.io Logging</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Additional Information</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../presentations_docs/">Archipelago Presentations and Documents</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../inthewild/">Archipelagos in the Wild</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../giveortake/">Contribution Guide</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../about/">About This Documentation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../acknowledgments/">Care & Coding + Fixing / Acknowledgments / License</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Pala Archipelago Documentation</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Instructions and Guides &raquo;</li>
          <li>Archipelago-Deployment-Live &raquo;</li>
      <li>Upgrading Drupal 8 to Drupal 9 (1.0.0-RC2 to 1.0.0-RC3)</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="archipelago-deployment-live-upgrading-drupal-8-to-drupal-9-100-rc2-to-100-rc3">Archipelago-deployment-live: upgrading Drupal 8 to Drupal 9 (1.0.0-RC2 to 1.0.0-RC3)</h1>
<h2 id="what-is-this-documentation-for">What is this documentation for?</h2>
<p>If you already have a well-set-up and well-loved Archipelago (RC2 or your own custom version) running Drupal 8 (D8), this documentation will allow you to update to Drupal 9 (D9) without major issues.</p>
<p>D8 is no longer supported as of the end of November 2021. D9 has been around for a little while and even if every module is not supported yet, what you need and want for <strong>Archipelago</strong> has long been D9-ready. </p>
<h2 id="requirements">Requirements</h2>
<ul>
<li>An <a href="https://github.com/esmero/archipelago-deployment-live">archipelago-deployment-live</a> instance 1.0.0-RC2 (working, tested) deployed using provided instructions via Docker and running Drupal 8.</li>
<li>Basic knowledge and instincts (+ courage) on how to run Terminal Commands, <code>composer</code> and <code>drush</code>.</li>
<li>Patience. You can't skip steps here.</li>
<li>For Shell Commands documented here please copy line by line—not the whole block.</li>
</ul>
<h2 id="backing-up-and-preparing-for-the-upgrade">Backing up and preparing for the upgrade</h2>
<p>Backups are always going to be your best friends. Archipelago's code, database and settings are mostly self-contained in your current <code>archipelago-deployment-live</code> repo folder, and backing up is simple because of that.</p>
<h3 id="step-1">Step 1:</h3>
<p>Shut down your <code>docker-compose</code> ensemble. Move to your <code>archipelago-deployment-live</code> folder and run this:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> deploy/ec2-docker
docker-compose down
</code></pre></div>
<h3 id="step-2">Step 2:</h3>
<p>Verify that all containers are actually down. The following command should return an empty listing. If anything is still running, wait a little longer, and run the following comman again.</p>
<div class="highlight"><pre><span></span><code>docker ps
</code></pre></div>
<h3 id="step-3">Step 3:</h3>
<p>Now let's <code>tar.gz</code> the whole ensemble with data and configs. As an example we will save this into your <code>$HOME</code> folder.
As a good practice we append the <strong>current date </strong>(YEAR-MONTH-DAY) to the filename. Here we assume today is December 1st of 2021.</p>
<div class="highlight"><pre><span></span><code>sudo tar -czvpf <span class="nv">$HOME</span>/archipelago-deployment-live-backup-20211201.tar.gz ../../../archipelago-deployment-live
</code></pre></div>
<p>The process may take a few minutes. Now let's verify that all is there and that the <code>tar.gz</code> is not corrupt.</p>
<div class="highlight"><pre><span></span><code>tar -tvvf <span class="nv">$HOME</span>/archipelago-deployment-live-backup-20211201.tar.gz 
</code></pre></div>
<p>You will see a listing of files. If corrupt (Do you have enough space? Did your ssh connection drop?) you will see the following:</p>
<div class="highlight"><pre><span></span><code>tar: Unrecognized archive format
</code></pre></div>
<h3 id="step-4">Step 4:</h3>
<p>Restart your <code>docker-compose</code> ensemble, and wait a little while for all to start.</p>
<div class="highlight"><pre><span></span><code>docker-compose up -d
</code></pre></div>
<h3 id="step-5">Step 5:</h3>
<p>Export/backup all of your live Archipelago configurations (this allows you to compare/come back in case you lose something custom during the upgrade).</p>
<div class="highlight"><pre><span></span><code>docker <span class="nb">exec</span> esmero-php mkdir config/backup
docker <span class="nb">exec</span> esmero-php drush cex --destination<span class="o">=</span>/var/www/html/config/backup
</code></pre></div>
<p>Good. Now it's safe to begin the upgrade.</p>
<hr />
<h2 id="upgrading-to-100-rc3">Upgrading to 1.0.0-RC3</h2>
<h3 id="step-1_1">Step 1:</h3>
<p>First we are going to disable modules that are not part of 1.0.0-RC3 or are not yet compatible with D9. Run the following command:</p>
<div class="highlight"><pre><span></span><code>docker <span class="nb">exec</span> esmero-php drush pm-uninstall module_missing_message_fixer markdown webprofiler key_value webform_views
</code></pre></div>
<p>From inside your <code>archipelago-deployment-live</code> repo folder we are going to open up the file <code>permissions</code> for some of your most protected Drupal files.</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> ../../
sudo chmod <span class="m">777</span> drupal/web/sites/default
sudo chmod <span class="m">666</span> drupal/web/sites/default/*settings.php
sudo chmod <span class="m">666</span> drupal/web/sites/default/*services.yml
</code></pre></div>
<h3 id="step-2_1">Step 2:</h3>
<p>Time to fetch the <code>1.0.0-RC3</code> branch and update our <code>docker-compose</code> and <code>composer</code> dependencies. We are also going to stop the current <code>docker</code> ensemble to update all containers to newer versions:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> deploy/ec2-docker
docker-compose down
git checkout <span class="m">1</span>.0.0-RC3 
</code></pre></div>
<p>Then copy the appropriate <code>docker-compose</code> file for your architecture:</p>
<details class="info">
<summary>OSX (macOS)/x86-64</summary>
<div class="highlight"><pre><span></span><code>cp docker-compose-osx.yml docker-compose.yml
</code></pre></div>
</details>
<details class="info">
<summary>Linux/x86-64/AMD64</summary>
<div class="highlight"><pre><span></span><code>cp docker-compose-linux.yml docker-compose.yml
</code></pre></div>
</details>
<details class="info">
<summary>OSX (macOS)/Linux/ARM64</summary>
<div class="highlight"><pre><span></span><code>cp docker-compose-arm64.yml docker-compose.yml
</code></pre></div>
</details>
<!--repo_docs

___

OSX (macOS)/x86-64:

<div class="highlight"><pre><span></span><code>cp docker-compose-osx.yml docker-compose.yml
</code></pre></div>

___

Linux/x86-64/AMD64:

<div class="highlight"><pre><span></span><code>cp docker-compose-linux.yml docker-compose.yml
</code></pre></div>

___

OSX (macOS)/Linux/ARM64:

<div class="highlight"><pre><span></span><code>cp docker-compose-arm64.yml docker-compose.yml
</code></pre></div>

___

repo_docs-->

<p>Finally, pull the images, and bring up the ensemble:</p>
<div class="highlight"><pre><span></span><code>docker compose pull 
docker compose up -d
</code></pre></div>
<p>Give all a little time to start. The latest <code>min.io</code> adds a new console, and your <code>Solr</code> core and <code>Database</code> need to be upgraded. Please be patient. To ensure all is well, run (more than once if necessary) the following:</p>
<div class="highlight"><pre><span></span><code>docker ps
</code></pre></div>
<p>You should see something like this: </p>
<div class="highlight"><pre><span></span><code>CONTAINER ID   IMAGE                                    COMMAND                  CREATED          STATUS          PORTS                                                           NAMES
867fd2a42134   nginx                                    <span class="s2">&quot;/docker-entrypoint.…&quot;</span>   <span class="m">32</span> seconds ago   Up <span class="m">27</span> seconds   <span class="m">0</span>.0.0.0:8001-&gt;80/tcp, :::8001-&gt;80/tcp                           esmero-web
8663e84a9b48   solr:8.8.2                               <span class="s2">&quot;docker-entrypoint.s…&quot;</span>   <span class="m">33</span> seconds ago   Up <span class="m">30</span> seconds   <span class="m">0</span>.0.0.0:8983-&gt;8983/tcp, :::8983-&gt;8983/tcp                       esmero-solr
9b580fa0088f   minio/minio:latest                       <span class="s2">&quot;/usr/bin/docker-ent…&quot;</span>   <span class="m">33</span> seconds ago   Up <span class="m">28</span> seconds   <span class="m">0</span>.0.0.0:9000-9001-&gt;9000-9001/tcp, :::9000-9001-&gt;9000-9001/tcp   esmero-minio
50e2f41c7b60   esmero/esmero-nlp:1.0                    <span class="s2">&quot;/usr/local/bin/entr…&quot;</span>   <span class="m">33</span> seconds ago   Up <span class="m">30</span> seconds   <span class="m">0</span>.0.0.0:6400-&gt;6400/tcp, :::6400-&gt;6400/tcp                       esmero-nlp
300810fd6f03   esmero/cantaloupe-s3:4.1.9RC             <span class="s2">&quot;sh -c &#39;java -Dcanta…&quot;</span>   <span class="m">33</span> seconds ago   Up <span class="m">30</span> seconds   <span class="m">0</span>.0.0.0:8183-&gt;8182/tcp, :::8183-&gt;8182/tcp                       esmero-cantaloupe
248e4638ba2a   mysql:8.0.22                             <span class="s2">&quot;docker-entrypoint.s…&quot;</span>   <span class="m">33</span> seconds ago   Up <span class="m">28</span> seconds   <span class="m">3306</span>/tcp, <span class="m">33060</span>/tcp                                             esmero-db
141ace919344   esmero/php-7.4-fpm:1.0.0-RC2-multiarch   <span class="s2">&quot;docker-php-entrypoi…&quot;</span>   <span class="m">33</span> seconds ago   Up <span class="m">28</span> seconds   <span class="m">9000</span>/tcp                                                        esmero-php
</code></pre></div>
<p>Important here is the <code>STATUS</code> column. It <strong>needs</strong> to be a number that goes up in time every time you run <code>docker ps</code> again (and again).</p>
<h3 id="step-3_1">Step 3:</h3>
<p>Now we are going to tell <code>composer</code> to actually fetch the new code and dependencies using the 1.0.0-RC3 provided <code>composer.lock</code> and update the whole Drupal/PHP/JS environment.</p>
<div class="highlight"><pre><span></span><code>docker <span class="nb">exec</span> -ti esmero-php bash -c <span class="s2">&quot;composer install&quot;</span>
</code></pre></div>
<p>This will fail (sorry!) for a few packages but no worries, they need to be patched and composer is not that smart. So simply run it again:</p>
<div class="highlight"><pre><span></span><code>docker <span class="nb">exec</span> -ti esmero-php bash -c <span class="s2">&quot;composer install&quot;</span>
</code></pre></div>
<p>Well done! If you see <strong>no</strong> issues and all ends in a <strong>Green colored message</strong> all is good! <a href="#step-4_1">Jump to Step 4</a></p>
<h4 id="what-if-not-all-is-ok-and-i-see-red-and-a-lot-of-dependency-explanations">What if not all is OK and I see red and a lot of dependency explanations?</h4>
<p>If you have manually installed packages via composer in the past that are NO longer Drupal 9 compatible you may see errors. 
In that case you need to check each package website's (normally https://www.drupal.org/project/the_module_name) and check if there is a Drupal 9 compatible version. </p>
<p>If so run:</p>
<div class="highlight"><pre><span></span><code>docker <span class="nb">exec</span> -ti esmero-php bash -c <span class="s2">&quot;composer require &#39;drupal/the_module_name:^VERSION_NUMBER_THAT_WORKS_ON_DRUPAL9_&#39; --update-with-dependencies --no-update&quot;</span> and run **Step <span class="m">3</span> ** again <span class="o">(</span>and again <span class="k">until</span> all is cleared<span class="o">)</span>
</code></pre></div>
<p>If not: try to find a replacement module that does something simular, but in any case you may end having to remove before proceding. Give us a ping/slack/google group/open a github ISSUE if you find yourself uncertain about this. </p>
<div class="highlight"><pre><span></span><code>docker <span class="nb">exec</span> -ti esmero-php bash -c <span class="s2">&quot;composer remove drupal/the_module_name --no-update&quot;</span>
docker <span class="nb">exec</span> -ti esmero-php bash -c <span class="s2">&quot; drush pm-uninstall the_module_name&quot;</span>
</code></pre></div>
<h3 id="step-4_1">Step 4:</h3>
<p>We will now ask Drupal to update some internal configs and databases. They will bring you up to date with RC3 settings and D9 particularities.</p>
<div class="highlight"><pre><span></span><code>docker <span class="nb">exec</span> -ti esmero-php bash -c <span class="s1">&#39;scripts/archipelago/setup.sh&#39;</span>
docker <span class="nb">exec</span> -ti esmero-php bash -c <span class="s1">&#39;drush urol administrator &quot;admin&quot;&#39;</span>
docker <span class="nb">exec</span> -ti esmero-php bash -c <span class="s2">&quot;drush updatedb&quot;</span>
</code></pre></div>
<h3 id="step-5_1">Step 5:</h3>
<p>Previously D8 installations had a "module/profile" driven installation. Those are no longer used or even exist as part of core, but a profile can't be changed once installed so you have to do the following to avoid Drupal complaining about our new and simpler way of doing things (a small roll back):</p>
<div class="highlight"><pre><span></span><code>docker <span class="nb">exec</span> -ti esmero-php bash -c <span class="s2">&quot;sed -i &#39;s/minimal: 1000/standard: 1000/g&#39; config/sync/core.extension.yml&quot;</span>
docker <span class="nb">exec</span> -ti esmero-php bash -c <span class="s2">&quot;sed -i &#39;s/profile: minimal/profile: standard/g&#39; config/sync/core.extension.yml&quot;</span>
</code></pre></div>
<h3 id="step-6">Step 6:</h3>
<p>Now you can Sync your new Archipelago 1.0.0-RC3 and bring all the new configs and settings in. For this you have <strong>two</strong> options (no worries, remember you made a backup!):</p>
<h4 id="a-partial-sync-which-will-bring-new-configs-and-update-existing-ones-but-will-not-remove-ones-that-only-exist-in-your-custom-setup-eg-new-webforms-or-view-modes">A Partial Sync, which will bring new configs and update existing ones but will <strong>not</strong> remove ones that only exist in your custom setup, e.g. new Webforms or View Modes.</h4>
<div class="highlight"><pre><span></span><code>docker <span class="nb">exec</span> esmero-php drush cim -y --partial
</code></pre></div>
<h4 id="a-complete-sync-which-will-bring-new-configs-and-update-existing-ones-but-will-also-remove-all-the-ones-that-are-not-part-of-rc3-its-a-like-clean-factory-reset">A Complete Sync, which will bring new configs and update existing ones but will also remove all the ones that are not part of RC3. It's a like clean factory reset.</h4>
<div class="highlight"><pre><span></span><code>docker <span class="nb">exec</span> esmero-php drush cim -y
</code></pre></div>
<p>If all goes well here and you see no errors it's time to reindex <code>Solr</code> because there are new Fields. Run the following:</p>
<div class="highlight"><pre><span></span><code>docker <span class="nb">exec</span> esmero-php drush search-api-reindex
docker <span class="nb">exec</span> esmero-php drush search-api-index
</code></pre></div>
<p>You might see some warnings related to modules dealing with previously non-existent data—no worries, just ignore those.</p>
<p>If you made it this far you are done with code/devops (are we ever ready?), and that means you should be able to (hopefully) stay in the Drupal 9 realm for a few years!</p>
<h3 id="step-7-update-or-not-your-metadata-display-entities-and-menu-items">Step 7: Update (or not) your Metadata Display Entities and Menu items.</h3>
<p>Recommended: If you want to add new templates and menu items 1.0.0-RC3 provides, run this:</p>
<div class="highlight"><pre><span></span><code>docker <span class="nb">exec</span> -ti esmero-php bash -c <span class="s1">&#39;scripts/archipelago/deploy.sh&#39;</span>
</code></pre></div>
<p>Once that is done, you can choose to update all Metadata Displays (Twig templates) we ship with new 1.0.0-RC3 versions (heavily fixed IIIF manifest, Markdown to HTML for Metadata, better Object descriptions). But before you do this, we <strong>really</strong> recommend that you first make sure to manually (copy/paste) backup any Twig templates you have modified. If unusure, do not run the command that comes after this warning! You can always manually copy the new templates from the <code>d8content/metadatadisplays</code> folder which contains text versions (again, copy/paste) of each shipped template you can pick and use when you feel ready.</p>
<p>If you are sure (like really?) you want to overwrite the ones you modified (sure, just checking?), then you can run this:</p>
<div class="highlight"><pre><span></span><code>docker <span class="nb">exec</span> -ti esmero-php bash -c <span class="s1">&#39;scripts/archipelago/update_deployed.sh&#39;</span>
</code></pre></div>
<p>Done! (For realz now)</p>
<p>Please log into your Archipelago and test/check all is working! Enjoy 1.0.0-RC3 and Drupal 9. Thanks!</p>
<hr />
<p>Thank you for reading! Please contact us on our <a href="https://groups.google.com/forum/#!forum/archipelago-commons">Archipelago Commons Google Group</a> with any questions or feedback, or open an ISSUE in this <a href="https://github.com/esmero/archipelago-deployment-live/">Archipelago Deployment Live Repository</a>.</p>
<p>Return to <a href="../archipelago-deployment-live-readme/">Archipelago Live Deployment</a>.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../archipelago-deployment-live-moveToLive/" class="btn btn-neutral float-left" title="Moving from archipelago-deployment to archipelago-deployment-live"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../firstobject/" class="btn btn-neutral float-right" title="Ingesting Your First Object">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../archipelago-deployment-live-moveToLive/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../firstobject/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme_extra.js" defer></script>
    <script src="../js/theme.js" defer></script>
      <script src="../search/main.js" defer></script>
      <script src="../js/version-select.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
